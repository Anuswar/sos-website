<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LifeGuard</title>

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />

    <!--=============== BOXICONS ===============-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"
    />

    <!--=============== FONT AWESOME ===============-->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    />

    <!--=============== SEIPER BUNDLE ===============-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"
    />

    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!--=============== LOADE SCREEN ===============-->
    <div class="loader">
      <div class="pin"></div>
      <div class="pulse"></div>
    </div>

    <div class="container">
      <!--=============== HEADER ===============-->
      <header class="header" id="header">
        <nav class="nav container-liquid">
          <!-- Logo -->
          <a href="#" class="nav__logo" onClick="window.location.reload()"
            >LifeGuard</a
          >

          <!-- MENU -->
          <div class="nav__menu" id="nav-menu">
            <div class="menuToggle">SOS</div>
            <ul class="nav__list">
              <li class="nav__item">
                <a href="#" id="nav-map" class="nav__link active-link">
                  <i class="bx bx-home nav__icon tabbar-icon1"></i>
                  <i class="bx bxs-home nav__icon tabbar-icon2"></i>
                  <span class="nav__name">Home</span>
                </a>
              </li>

              <li class="nav__item">
                <a href="#" id="nav-place" class="nav__link">
                  <i class="bx bx-buildings nav__icon tabbar-icon1"></i>
                  <i class="bx bxs-buildings nav__icon tabbar-icon2"></i>
                  <span class="nav__name">Place</span>
                </a>
              </li>

              <li class="nav__item no__nav__item"></li>

              <li class="nav__item">
                <a href="#" id="nav-aid" class="nav__link">
                  <i class="bx bx-conversation nav__icon tabbar-icon1"></i>
                  <i class="bx bxs-conversation nav__icon tabbar-icon2"></i>
                  <span class="nav__name">Aid</span>
                </a>
              </li>

              <li class="nav__item">
                <a href="#" id="nav-info" class="nav__link">
                  <i class="bx bx-user nav__icon tabbar-icon1"></i>
                  <i class="bx bxs-user nav__icon tabbar-icon2"></i>
                  <span class="nav__name">Info</span>
                </a>
              </li>
            </ul>
          </div>

          <div class="nav-icons">
            <!-- MOBILE MENU TOGGLE -->
            <div class="navbar">
              <div class="toggle_btn">
                <i class="bx bx-menu"></i>
              </div>
            </div>
          </div>
          <div class="dropdown_menu">
            <ul>
              <li><a href="/other/download.html">Download</a></li>
              <li><a href="/other/about.html">About</a></li>
              <li>
                <a href="https://github.com/Anuswar/issues/new"
                  >send feedback</a
                >
              </li>
            </ul>
          </div>
        </nav>
      </header>

      <div id="map">
        <!--=============== SHARE ===============-->
        <a href="#" class="share" title="Share your location">
          <i class="bx bx-share bx-flip-horizontal" style="color: #ffffff"></i>
        </a>
      </div>

      <div style="display: none" id="place">
        <!--=============== SILDE MENU ===============-->
        <div class="wrapper12">
          <ul class="tabs-box">
            <li class="tab filter-item active-filter" data-filter="all">All</li>
            <li class="tab filter-item" data-filter="hospital">Hospital</li>
            <li class="tab filter-item" data-filter="Police">Police station</li>
            <li class="tab filter-item" data-filter="atm">AIM</li>
            <li class="tab filter-item" data-filter="petrol">Petrol pump</li>
          </ul>
        </div>

        <ul class="cards all hospital" id="hospital-list"></ul>
        <ul class="cards all Police" id="police-station-list"></ul>
        <ul class="cards all atm" id="atm-mission-list"></ul>
        <ul class="cards all petrol" id="petrol-pump-list"></ul>
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
      </div>

      <div style="display: none; background: yellow" id="aid"></div>

      <div style="display: none; background: wheat" id="info"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <script
      src="https://code.jquery.com/jquery-3.6.3.js"
      integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
      crossorigin="anonymous"
    ></script>

    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

    <script>
      /*=============== map ===============*/
      // Initialize Leaflet map
      var map = L.map("map");

      // Create a tile layer with OpenStreetMap data
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      // Fetch user's location and display it on the map
      map.locate({ setView: true, maxZoom: 18 }); // Adjusted the maxZoom value

      function onLocationFound(e) {
        var marker = L.marker(e.latlng).addTo(map);
        marker.bindPopup("You are here!").openPopup();

        // Zoom in further to the user's location
        map.setView(e.latlng, 18);

        // Define the amenities and their respective classes
        var amenities = [
          { amenity: "hospital", className: "hospital" },
          { amenity: "police", className: "police-station" },
          { amenity: "atm", className: "atm-mission" },
          { amenity: "fuel", className: "petrol-pump" },
        ];

        // Fetch nearby amenities
        amenities.forEach(function (amenity) {
          var request = new XMLHttpRequest();
          var bounds = map.getBounds();
          var url =
            "https://www.overpass-api.de/api/interpreter?data=[out:json];node(around:1000," +
            e.latlng.lat +
            "," +
            e.latlng.lng +
            ")[amenity=" +
            amenity.amenity +
            "];out;";

          request.open("GET", url, true);
          request.onreadystatechange = function () {
            if (request.readyState === 4 && request.status === 200) {
              var elements = JSON.parse(request.responseText).elements;

              var placeDiv = document.getElementById("place");
              var list = document.getElementById(amenity.className + "-list");
              if (!list) {
                list = document.createElement("ul");
                list.id = amenity.className + "-list";
                placeDiv.appendChild(list);
              }

              elements.forEach(function (element) {
                var name =
                  element.tags.name ||
                  element.tags["name:en"] ||
                  element.tags["name:fr"] ||
                  element.tags.operator ||
                  "N/A";
                var latLng = L.latLng(element.lat, element.lon);
                var distance =
                  (e.latlng.distanceTo(latLng) / 5000).toFixed(2) +
                  " kilometers";
                var address =
                  element.tags["addr:full"] ||
                  element.tags["addr:housename"] ||
                  element.tags["addr:housenumber"] ||
                  element.tags["addr:street"] ||
                  element.tags["addr:postcode"] ||
                  element.tags["addr:city"] ||
                  element.tags["addr:country"] ||
                  "Address not available";
                var contact =
                  element.tags.phone ||
                  element.tags["contact:phone"] ||
                  element.tags.phone_1 ||
                  element.tags["phone:emergency"] ||
                  element.tags.email ||
                  element.tags.website ||
                  "Contact information not available";

                var listItem = document.createElement("li");
                listItem.classList.add(amenity.className);
                listItem.innerHTML =
                  "<strong>Name:</strong> " +
                  name +
                  "<br><strong>Address:</strong> " +
                  address +
                  "<br><strong>Contact:</strong> " +
                  contact +
                  "<br><strong>Distance:</strong> " +
                  distance;
                list.appendChild(listItem);
              });
            }
          };

          request.send();
        });
      }

      map.on("locationfound", onLocationFound);
    </script>

    <script src="script.js"></script>
  </body>
</html>
